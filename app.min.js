class ThemeManager{constructor(){this.root=document.documentElement,this.body=document.body,this.storageKey="theme",this.toggleBtn=document.getElementById("theme-toggle"),this.init()}init(){this.loadSavedTheme(),this.toggleBtn.addEventListener("click",()=>this.toggle()),this.observeSystemPreference()}loadSavedTheme(){const e=localStorage.getItem(this.storageKey);if("dark"===e)this.setDark();else if("light"===e)this.setLight();else{window.matchMedia("(prefers-color-scheme: dark)").matches?this.setDark():this.setLight()}}toggle(){this.body.classList.contains("dark")?this.setLight():this.setDark()}setDark(){this.root.classList.add("dark"),this.body.classList.add("dark"),localStorage.setItem(this.storageKey,"dark")}setLight(){this.root.classList.remove("dark"),this.body.classList.remove("dark"),localStorage.setItem(this.storageKey,"light")}observeSystemPreference(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem(this.storageKey)||(e.matches?this.setDark():this.setLight())})}}const lessonsDB={1:{title:"01. Introduzione",subtitle:"Analisi Dimensionale",date:"10/11/2025",filename:"01_intro.txt",description:"Definizione del vocabolario della fisica, Sistema Internazionale (SI) e analisi dimensionale.",content:'\n            <header class="mb-12 border-b-2 border-black dark:border-gray-400 pb-6">\n                <h1 class="text-3xl md:text-4xl font-bold tracking-tighter mb-4 text-black dark:text-gray-100">01. Introduzione</h1>\n                <div class="text-sm text-gray-600 dark:text-gray-400">Data: 10/11/2025</div>\n            </header>\n            <article class="space-y-6 text-justify dark:text-gray-200">\n                <p>In questa lezione introduttiva, definiamo le grandezze fisiche fondamentali e le loro unità di misura.</p>\n                <h2 class="text-xl font-bold uppercase mt-8 mb-4 border-b border-gray-300 dark:border-gray-600 pb-1 text-black dark:text-gray-100">Analisi Dimensionale</h2>\n                <p>Ogni grandezza fisica $G$ può essere espressa in termini di grandezze fondamentali:</p>\n                <div class="formula-block py-2">$$ [G] = L^a M^b T^c $$</div>\n                <p>Questa notazione è fondamentale per verificare la correttezza dimensionale delle formule fisiche.</p>\n            </article>\n        '},2:{title:"02. Cinematica",subtitle:"Del Punto Materiale",date:"12/11/2025",filename:"02_cinematica.txt",description:"Posizione, velocità e accelerazione. Moto rettilineo uniforme e uniformemente accelerato.",content:'\n            <header class="mb-12 border-b-2 border-black dark:border-gray-400 pb-6">\n                <h1 class="text-3xl md:text-4xl font-bold tracking-tighter mb-4 text-black dark:text-gray-100">02. Cinematica</h1>\n                <div class="text-sm text-gray-600 dark:text-gray-400">Data: 12/11/2025</div>\n            </header>\n            <article class="space-y-6 text-justify dark:text-gray-200">\n                <p>Descriviamo il moto indipendentemente dalle cause. L\'equazione oraria fondamentale per il moto uniformemente accelerato è:</p>\n                <div class="formula-block py-2">$$ x(t) = x_0 + v_0 t + \\frac{1}{2} a t^2 $$</div>\n                <p>Da cui deriviamo la velocità come derivata della posizione rispetto al tempo: $v(t) = \\frac{dx}{dt}$.</p>\n            </article>\n        '},3:{title:"03. Dinamica",subtitle:"I Principi",date:"15/11/2025",filename:"03_dinamica.txt",description:"I tre principi di Newton, F=ma, diagrammi di corpo libero e piano inclinato.",content:'\n            <header class="mb-12 border-b-2 border-black dark:border-gray-400 pb-6">\n                <h1 class="text-3xl md:text-4xl font-bold tracking-tighter mb-4 text-black dark:text-gray-100">03. I Principi della Dinamica</h1>\n                <div class="text-sm text-gray-600 dark:text-gray-400">Data: 15/11/2025</div>\n            </header>\n            <article class="space-y-6 text-justify dark:text-gray-200">\n                <p>La dinamica studia le cause del moto. Il secondo principio di Newton è la chiave di volta della meccanica classica:</p>\n                <div class="formula-block py-2">$$ \\vec{F} = m \\cdot \\vec{a} $$</div>\n                \n                <h2 class="text-xl font-bold uppercase mt-10 mb-4 border-b border-gray-300 dark:border-gray-600 pb-1 text-black dark:text-gray-100">Esempio: Piano Inclinato</h2>\n                <div class="my-8 border border-black dark:border-gray-400 p-4 flex justify-center bg-white dark:bg-gray-800">\n                    <svg width="100%" height="250" viewBox="0 0 400 250" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">\n                        <defs>\n                            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">\n                                <polygon points="0 0, 10 3.5, 0 7" fill="currentColor" />\n                            </marker>\n                        </defs>\n                        <line x1="50" y1="200" x2="350" y2="200" stroke="currentColor" stroke-width="2" />\n                        <line x1="50" y1="200" x2="350" y2="50" stroke="currentColor" stroke-width="2" />\n                        <path d="M 100 200 Q 110 190 120 187" stroke="currentColor" fill="none" />\n                        <text x="130" y="195" font-family="Courier New" font-size="14" fill="currentColor">θ</text>\n                        <rect x="180" y="115" width="40" height="40" transform="rotate(-26.5 200 135)" fill="white" stroke="currentColor" stroke-width="2"/>\n                        <text x="195" y="140" font-family="Courier New" font-size="14" font-weight="bold" fill="currentColor">m</text>\n                        <line x1="200" y1="135" x2="200" y2="210" stroke="currentColor" stroke-width="2" marker-end="url(#arrowhead)" />\n                        <text x="205" y="225" font-family="Courier New" font-size="14" fill="currentColor">P</text>\n                    </svg>\n                </div>\n                <p>L\'accelerazione lungo il piano (senza attrito) è $a = g \\sin(\\theta)$.</p>\n            </article>\n        '},4:{title:"04. Energia",subtitle:"Lavoro e Potenza",date:"18/11/2025",filename:"04_energia.txt",description:"Lavoro, energia cinetica, forze conservative ed energia potenziale.",content:'\n            <header class="mb-12 border-b-2 border-black dark:border-gray-400 pb-6">\n                <h1 class="text-3xl md:text-4xl font-bold tracking-tighter mb-4 text-black dark:text-gray-100">04. Lavoro ed Energia</h1>\n                <div class="text-sm text-gray-600 dark:text-gray-400">Data: 18/11/2025</div>\n            </header>\n            <article class="space-y-6 text-justify dark:text-gray-200">\n                <p>Il lavoro compiuto da una forza costante è il prodotto scalare tra forza e spostamento.</p>\n                <div class="formula-block py-2">$$ W = \\vec{F} \\cdot \\vec{d} = F d \\cos(\\theta) $$</div>\n                <p>Questo concetto ci porta al teorema dell\'energia cinetica: $W = \\Delta K$.</p>\n            </article>\n        '}};class Router{constructor(){this.views={landing:document.getElementById("view-landing"),index:document.getElementById("view-index"),lesson:document.getElementById("view-lesson")},this.currentLessonId=null,this.init()}init(){this.populateIndex(),this.setupEventDelegation()}setupEventDelegation(){document.addEventListener("click",e=>{const t=e.target.closest(".nav-btn");if(!t)return;const a=t.dataset.route,n=t.dataset.lessonId;"landing"===a?this.goToLanding():"index"===a?this.goToIndex():"lesson"===a&&this.goToLesson(n)})}populateIndex(){const e=document.getElementById("lessons-list-container");let t="";for(const e in lessonsDB){const a=lessonsDB[e];t+=`\n                <article class="group" role="listitem">\n                    <header>\n                        <h3 class="text-2xl font-bold mb-1">\n                            <button class="nav-btn standard-link" data-route="lesson" data-lesson-id="${e}" aria-label="Vai alla lezione: ${a.title}">\n                                ${a.title}\n                            </button>\n                        </h3>\n                        <div class="arrow-deco text-lg mb-2" aria-hidden="true">▼</div>\n                        <div class="text-gray-500 dark:text-gray-400 text-sm mb-4 font-medium">Pubblicato il: ${a.date}</div>\n                    </header>\n                    <div class="mb-3 dark:text-gray-300"><p>${a.description}</p></div>\n                    <footer>\n                        <button class="nav-btn text-sm font-bold uppercase tracking-wide standard-link" data-route="lesson" data-lesson-id="${e}" aria-label="Leggi la lezione ${a.title}">\n                            [ Leggi ]\n                        </button>\n                    </footer>\n                </article>\n            `}e.innerHTML=t}hideAll(){Object.values(this.views).forEach(e=>{e.classList.remove("active")})}goToLanding(){this.hideAll(),this.views.landing.classList.add("active"),window.scrollTo(0,0)}goToIndex(){this.hideAll(),this.views.index.classList.add("active"),window.scrollTo(0,0)}goToLesson(e){const t=parseInt(e),a=lessonsDB[t];if(!a)return void console.warn(`Lezione ${t} non trovata`);this.currentLessonId=t;const n=document.getElementById("lesson-content-container");n.innerHTML=a.content,document.getElementById("lesson-breadcrumbs-id").textContent=a.filename,window.renderMathInElement&&renderMathInElement(n,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1}),this.renderNavigation(t),this.hideAll(),this.views.lesson.classList.add("active"),window.scrollTo(0,0)}renderNavigation(e){const t=document.getElementById("nav-prev-container"),a=document.getElementById("nav-next-container"),n=e-1,i=e+1;t.innerHTML=lessonsDB[n]?`\n                <span class="block text-xs text-gray-500 dark:text-gray-400 uppercase mb-1">Precedente</span>\n                <button class="nav-btn standard-link font-bold text-sm md:text-base" data-route="lesson" data-lesson-id="${n}">\n                    ← ${lessonsDB[n].title}\n                </button>\n            `:'\n                <span class="block text-xs text-gray-500 dark:text-gray-400 uppercase mb-1">Indice</span>\n                <button class="nav-btn standard-link font-bold text-sm md:text-base" data-route="index">\n                    ← Torna all\'Indice\n                </button>\n            ',a.innerHTML=lessonsDB[i]?`\n                <span class="block text-xs text-gray-500 dark:text-gray-400 uppercase mb-1">Successiva</span>\n                <button class="nav-btn standard-link font-bold text-sm md:text-base" data-route="lesson" data-lesson-id="${i}">\n                    ${lessonsDB[i].title} →\n                </button>\n            `:'\n                <span class="block text-xs text-gray-400 dark:text-gray-500 uppercase mb-1">Fine Corso</span>\n                <span class="text-gray-300 dark:text-gray-600 cursor-not-allowed font-bold text-sm md:text-base">\n                    Nessuna lezione successiva\n                </span>\n            '}}document.addEventListener("DOMContentLoaded",()=>{new ThemeManager,new Router});